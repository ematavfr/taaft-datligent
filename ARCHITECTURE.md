# Architecture - TAAFT Datligent

This document describes the architecture of the **TAAFT Datligent** project using a Mermaid diagram.

## Architecture Diagram

```mermaid
graph TD
    subgraph "External Services"
        Gmail["Gmail API (TAAFT Newsletters)"]
        Notion["Notion API (Sync)"]
        Deepl["DeepL API (Translation)"]
        LLM["External/Local LLM"]
    end

    subgraph "Docker Stack"
        Frontend["Frontend (Vite/React)"]
        Backend["Backend (Uvicorn/FastAPI)"]
        DB[("PostgreSQL DB (taaft)")]
        Ingestor["Ingest-Scheduler"]
        DBUpdater["DB Updater (updater.py)"]
    end

    Gmail -->|Fetch| Ingestor
    Ingestor -->|Translate| Deepl
    Ingestor -->|Process| LLM
    Ingestor -->|Sync| Notion
    Ingestor -->|Generate SQL| Updates["/updates (SQL Files)"]
    
    Updates -->|Read| DBUpdater
    DBUpdater -->|Execute SQL| DB
    
    Frontend -->|Requests| Backend
    Backend -->|Query| DB
```

## Application Logic Flow (Ingestion & Sync)

*Voir aussi : [ingest_taaft.mermaid](file:///Users/adminmac/taaft-datligent/ingestion/ingest_taaft.mermaid)*

The TAAFT ingestor includes translation and synchronization with Notion.

```mermaid
sequenceDiagram
    participant S as ingest_taaft.py
    participant G as Gmail API
    participant L as LLM (qwen3)
    participant N as Notion API
    participant U as updates/ (SQL)

    S->>G: Search for TAAFT Newsletter (ON target_date)
    G-->>S: Return matching emails
    S->>S: Parse HTML sections (Today's Spotlight, etc.)
    loop For each tool/item
        S->>L: Request French translation + technical tags
        L-->>S: Return JSON metadata
        alt if item_type is 'prompt'
            S->>N: Sync prompt and metadata to Notion DB
        end
    end
    S->>U: Generate and save .sql file
```

## Component Roles

- **Frontend**: Modern web interface (Vite) for managing TAAFT articles.
- **Backend**: Python-based API server.
- **DB (PostgreSQL)**: Database for storing all processed TAAFT data.
- **Ingest-Scheduler**: Complex service that fetches TAAFT newsletters, translates content via DeepL, extracts metadata using an LLM, and synchronizes results with a Notion database.
- **DB Updater**: Python script that applies SQL updates generated by the ingestor.
- **Notion Integration**: Specific to TAAFT, allows external tracking and management of articles.
